---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: managedroosts.roost.birb.party
spec:
  group: roost.birb.party
  names:
    kind: ManagedRoost
    listKind: ManagedRoostList
    plural: managedroosts
    singular: managedroost
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.health
      name: Health
      type: string
    - jsonPath: .spec.chart.name
      name: Chart
      type: string
    - jsonPath: .spec.chart.version
      name: Version
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ManagedRoost is the Schema for the managedroosts API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ManagedRoostSpec defines the desired state of ManagedRoost
            properties:
              chart:
                description: Chart specifies the Helm chart configuration
                properties:
                  hooks:
                    description: Helm hooks configuration
                    properties:
                      postInstall:
                        default: true
                        description: Enable post-install hooks
                        type: boolean
                      postUpgrade:
                        default: true
                        description: Enable post-upgrade hooks
                        type: boolean
                      preInstall:
                        default: true
                        description: Enable pre-install hooks
                        type: boolean
                      preUpgrade:
                        default: true
                        description: Enable pre-upgrade hooks
                        type: boolean
                      timeout:
                        default: 60s
                        description: Hook timeout
                        type: string
                    type: object
                  name:
                    description: Chart name
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                  repository:
                    description: Repository configuration
                    properties:
                      auth:
                        description: Authentication for private repositories
                        properties:
                          password:
                            description: Password for basic auth
                            type: string
                          secretRef:
                            description: Secret containing authentication credentials
                            properties:
                              key:
                                description: Key within the Secret
                                type: string
                              name:
                                description: Name of the Secret
                                type: string
                              namespace:
                                description: Namespace of the Secret
                                type: string
                            required:
                            - name
                            type: object
                          username:
                            description: Username for basic auth
                            type: string
                        type: object
                      tls:
                        description: TLS configuration
                        properties:
                          caBundle:
                            description: CA certificate bundle
                            format: byte
                            type: string
                          insecureSkipVerify:
                            default: false
                            description: Skip TLS verification
                            type: boolean
                          secretRef:
                            description: Secret containing TLS certificates
                            properties:
                              key:
                                description: Key within the Secret
                                type: string
                              name:
                                description: Name of the Secret
                                type: string
                              namespace:
                                description: Namespace of the Secret
                                type: string
                            required:
                            - name
                            type: object
                        type: object
                      type:
                        default: http
                        description: Repository type
                        enum:
                        - http
                        - oci
                        - git
                        type: string
                      url:
                        description: Repository URL
                        pattern: ^(https?|oci|git\+https)://.*$
                        type: string
                    required:
                    - url
                    type: object
                  upgradePolicy:
                    description: Helm upgrade configuration
                    properties:
                      atomic:
                        default: true
                        description: Enable atomic upgrades
                        type: boolean
                      cleanupOnFail:
                        default: true
                        description: Cleanup on failure
                        type: boolean
                      force:
                        default: false
                        description: Force upgrade even if resources are unchanged
                        type: boolean
                      timeout:
                        default: 300s
                        description: Timeout for upgrade operations
                        type: string
                    type: object
                  values:
                    description: Values override for the chart
                    properties:
                      configMapRefs:
                        description: Values from ConfigMaps
                        items:
                          description: ValueSourceRef defines a reference to a ConfigMap
                            or Secret for values
                          properties:
                            key:
                              description: Key within the ConfigMap or Secret
                              type: string
                            name:
                              description: Name of the ConfigMap or Secret
                              type: string
                            namespace:
                              description: Namespace of the ConfigMap or Secret
                              type: string
                          required:
                          - name
                          type: object
                        type: array
                      inline:
                        description: Inline values (YAML string)
                        type: string
                      secretRefs:
                        description: Values from Secrets
                        items:
                          description: ValueSourceRef defines a reference to a ConfigMap
                            or Secret for values
                          properties:
                            key:
                              description: Key within the ConfigMap or Secret
                              type: string
                            name:
                              description: Name of the ConfigMap or Secret
                              type: string
                            namespace:
                              description: Namespace of the ConfigMap or Secret
                              type: string
                          required:
                          - name
                          type: object
                        type: array
                      template:
                        description: Template processing configuration
                        properties:
                          context:
                            additionalProperties:
                              type: string
                            description: Template context variables (key-value pairs
                              as strings)
                            type: object
                          enabled:
                            default: false
                            description: Enable template processing
                            type: boolean
                        type: object
                    type: object
                  version:
                    description: Chart version or version constraint
                    type: string
                required:
                - name
                - repository
                - version
                type: object
              healthChecks:
                description: HealthChecks defines the health check configuration
                items:
                  description: HealthCheckSpec defines health monitoring configuration
                  properties:
                    failureThreshold:
                      default: 3
                      description: Number of consecutive failures before marking unhealthy
                      format: int32
                      minimum: 1
                      type: integer
                    grpc:
                      description: gRPC health check configuration
                      properties:
                        host:
                          description: Target host
                          type: string
                        port:
                          description: Target port
                          format: int32
                          maximum: 65535
                          minimum: 1
                          type: integer
                        service:
                          description: Service name for health check
                          type: string
                        tls:
                          description: TLS configuration
                          properties:
                            insecureSkipVerify:
                              default: false
                              description: Skip TLS verification
                              type: boolean
                          type: object
                      required:
                      - host
                      - port
                      type: object
                    http:
                      description: HTTP health check configuration
                      properties:
                        expectedBody:
                          description: Expected response body pattern
                          type: string
                        expectedCodes:
                          description: Expected status codes
                          items:
                            format: int32
                            type: integer
                          type: array
                        headers:
                          additionalProperties:
                            type: string
                          description: HTTP headers
                          type: object
                        method:
                          default: GET
                          description: HTTP method
                          enum:
                          - GET
                          - POST
                          - PUT
                          - HEAD
                          type: string
                        tls:
                          description: TLS configuration
                          properties:
                            insecureSkipVerify:
                              default: false
                              description: Skip TLS verification
                              type: boolean
                          type: object
                        url:
                          description: Target URL or URL template
                          type: string
                      required:
                      - url
                      type: object
                    interval:
                      default: 30s
                      description: Check interval
                      type: string
                    kubernetes:
                      description: Kubernetes native health check configuration
                      properties:
                        resources:
                          description: Resources to check
                          items:
                            description: KubernetesResourceCheck defines a single
                              Kubernetes resource health check
                            properties:
                              apiVersion:
                                description: API version of the resource
                                type: string
                              conditions:
                                description: Expected conditions
                                items:
                                  description: ExpectedCondition defines an expected
                                    condition for a Kubernetes resource
                                  properties:
                                    status:
                                      description: Expected status
                                      enum:
                                      - "True"
                                      - "False"
                                      - Unknown
                                      type: string
                                    type:
                                      description: Condition type
                                      type: string
                                  required:
                                  - status
                                  - type
                                  type: object
                                type: array
                              kind:
                                description: Kind of the resource
                                type: string
                              labelSelector:
                                additionalProperties:
                                  type: string
                                description: Label selector for resources
                                type: object
                            required:
                            - apiVersion
                            - kind
                            type: object
                          type: array
                      required:
                      - resources
                      type: object
                    name:
                      description: Health check name
                      type: string
                    prometheus:
                      description: Prometheus health check configuration
                      properties:
                        endpoint:
                          description: Prometheus endpoint URL
                          type: string
                        operator:
                          default: gte
                          description: Comparison operator
                          enum:
                          - gt
                          - gte
                          - lt
                          - lte
                          - eq
                          - ne
                          type: string
                        query:
                          description: Prometheus query
                          type: string
                        threshold:
                          description: Expected threshold value (as string to support
                            decimals)
                          type: string
                      required:
                      - query
                      - threshold
                      type: object
                    tcp:
                      description: TCP health check configuration
                      properties:
                        host:
                          description: Target host
                          type: string
                        port:
                          description: Target port
                          format: int32
                          maximum: 65535
                          minimum: 1
                          type: integer
                      required:
                      - host
                      - port
                      type: object
                    timeout:
                      default: 10s
                      description: Timeout for individual checks
                      type: string
                    type:
                      description: Health check type
                      enum:
                      - http
                      - tcp
                      - grpc
                      - prometheus
                      - kubernetes
                      type: string
                    weight:
                      default: 1
                      description: Weight for composite health evaluation
                      format: int32
                      maximum: 100
                      minimum: 0
                      type: integer
                  required:
                  - name
                  - type
                  type: object
                type: array
              metadata:
                additionalProperties:
                  type: string
                description: Metadata for operational tracking
                type: object
              namespace:
                description: Namespace specifies the target namespace for the Helm
                  deployment
                type: string
              observability:
                description: Observability defines observability configuration
                properties:
                  logging:
                    description: Logging configuration
                    properties:
                      level:
                        default: info
                        description: Logging level
                        enum:
                        - debug
                        - info
                        - warn
                        - error
                        type: string
                      outputs:
                        description: Additional log outputs
                        items:
                          description: LogOutputSpec defines additional log output
                            configuration
                          properties:
                            config:
                              additionalProperties:
                                type: string
                              description: Output configuration
                              type: object
                            type:
                              description: Output type
                              enum:
                              - file
                              - syslog
                              - http
                              - kafka
                              type: string
                          required:
                          - type
                          type: object
                        type: array
                      structured:
                        default: true
                        description: Enable structured logging
                        type: boolean
                    type: object
                  metrics:
                    description: Metrics configuration
                    properties:
                      custom:
                        description: Custom metrics to collect
                        items:
                          description: CustomMetricSpec defines a custom metric to
                            collect
                          properties:
                            name:
                              description: Metric name
                              type: string
                            query:
                              description: Metric query or source
                              type: string
                            type:
                              default: gauge
                              description: Metric type
                              enum:
                              - counter
                              - gauge
                              - histogram
                              - summary
                              type: string
                          required:
                          - name
                          - query
                          type: object
                        type: array
                      enabled:
                        default: true
                        description: Enable metrics collection
                        type: boolean
                      interval:
                        default: 15s
                        description: Metrics collection interval
                        type: string
                    type: object
                  tracing:
                    description: Tracing configuration
                    properties:
                      enabled:
                        default: false
                        description: Enable distributed tracing
                        type: boolean
                      endpoint:
                        description: Tracing endpoint configuration
                        properties:
                          auth:
                            description: Authentication configuration
                            properties:
                              bearerToken:
                                description: Bearer token
                                type: string
                              headers:
                                additionalProperties:
                                  type: string
                                description: Headers for authentication
                                type: object
                            type: object
                          url:
                            description: Endpoint URL
                            type: string
                        required:
                        - url
                        type: object
                      samplingRate:
                        default: "0.1"
                        description: Sampling rate for traces (as string, e.g., "0.1")
                        type: string
                    type: object
                type: object
              teardownPolicy:
                description: TeardownPolicy defines when and how to teardown roosts
                properties:
                  cleanup:
                    description: Cleanup configuration
                    properties:
                      force:
                        default: true
                        description: Force cleanup if grace period expires
                        type: boolean
                      gracePeriod:
                        default: 30s
                        description: Grace period for resource cleanup
                        type: string
                      order:
                        description: Cleanup order for resources
                        items:
                          type: string
                        type: array
                    type: object
                  dataPreservation:
                    description: Data preservation policy
                    properties:
                      backupPolicy:
                        description: Backup policy configuration
                        properties:
                          retention:
                            default: 7d
                            description: Backup retention period
                            type: string
                          schedule:
                            description: Backup schedule (cron expression)
                            type: string
                          storage:
                            description: Backup storage configuration
                            properties:
                              config:
                                additionalProperties:
                                  type: string
                                description: Storage configuration
                                type: object
                              type:
                                description: Storage type
                                enum:
                                - s3
                                - gcs
                                - azure
                                - local
                                type: string
                            type: object
                        type: object
                      enabled:
                        default: false
                        description: Enable data preservation
                        type: boolean
                      preserveResources:
                        description: Resources to preserve
                        items:
                          type: string
                        type: array
                    type: object
                  requireManualApproval:
                    default: false
                    description: Manual teardown protection
                    type: boolean
                  triggers:
                    description: Automatic teardown triggers
                    items:
                      description: TeardownTriggerSpec defines teardown trigger conditions
                      properties:
                        failureCount:
                          description: Failure count trigger
                          format: int32
                          minimum: 1
                          type: integer
                        resourceThreshold:
                          description: Resource threshold trigger
                          properties:
                            cpu:
                              anyOf:
                              - type: integer
                              - type: string
                              description: CPU threshold
                              x-kubernetes-int-or-string: true
                            custom:
                              additionalProperties:
                                anyOf:
                                - type: integer
                                - type: string
                                x-kubernetes-int-or-string: true
                              description: Custom resource thresholds
                              type: object
                            memory:
                              anyOf:
                              - type: integer
                              - type: string
                              description: Memory threshold
                              x-kubernetes-int-or-string: true
                            storage:
                              anyOf:
                              - type: integer
                              - type: string
                              description: Storage threshold
                              x-kubernetes-int-or-string: true
                          type: object
                        schedule:
                          description: Schedule-based trigger (cron expression)
                          type: string
                        timeout:
                          description: Timeout-based trigger
                          type: string
                        type:
                          description: Trigger type
                          enum:
                          - timeout
                          - failure_count
                          - resource_threshold
                          - schedule
                          - webhook
                          type: string
                        webhook:
                          description: Webhook-based trigger
                          properties:
                            auth:
                              description: Authentication configuration
                              properties:
                                basicAuth:
                                  description: Basic auth credentials
                                  properties:
                                    password:
                                      description: Password
                                      type: string
                                    username:
                                      description: Username
                                      type: string
                                  required:
                                  - password
                                  - username
                                  type: object
                                bearerToken:
                                  description: Bearer token
                                  type: string
                              type: object
                            headers:
                              additionalProperties:
                                type: string
                              description: HTTP headers
                              type: object
                            method:
                              default: POST
                              description: HTTP method
                              enum:
                              - GET
                              - POST
                              - PUT
                              type: string
                            url:
                              description: Webhook URL
                              type: string
                          required:
                          - url
                          type: object
                      required:
                      - type
                      type: object
                    type: array
                type: object
              tenancy:
                description: Tenancy defines multi-tenant configuration
                properties:
                  namespaceIsolation:
                    description: Namespace isolation configuration
                    properties:
                      annotations:
                        additionalProperties:
                          type: string
                        description: Additional namespace annotations
                        type: object
                      enabled:
                        default: false
                        description: Enable namespace isolation
                        type: boolean
                      labels:
                        additionalProperties:
                          type: string
                        description: Additional namespace labels
                        type: object
                      prefix:
                        description: Namespace prefix for tenant resources
                        type: string
                    type: object
                  networkPolicy:
                    description: Network policies
                    properties:
                      egress:
                        description: Egress rules
                        items:
                          description: NetworkPolicyRule defines a network policy
                            rule
                          properties:
                            from:
                              description: Allowed sources/destinations
                              items:
                                description: NetworkPolicyPeer defines a network policy
                                  peer
                                properties:
                                  namespaceSelector:
                                    additionalProperties:
                                      type: string
                                    description: Namespace selector
                                    type: object
                                  podSelector:
                                    additionalProperties:
                                      type: string
                                    description: Pod selector
                                    type: object
                                type: object
                              type: array
                            ports:
                              description: Allowed ports
                              items:
                                description: NetworkPolicyPort defines a network policy
                                  port
                                properties:
                                  port:
                                    anyOf:
                                    - type: integer
                                    - type: string
                                    description: Port number or name
                                    x-kubernetes-int-or-string: true
                                  protocol:
                                    default: TCP
                                    description: Protocol
                                    enum:
                                    - TCP
                                    - UDP
                                    - SCTP
                                    type: string
                                type: object
                              type: array
                            to:
                              description: Allowed destinations/sources
                              items:
                                description: NetworkPolicyPeer defines a network policy
                                  peer
                                properties:
                                  namespaceSelector:
                                    additionalProperties:
                                      type: string
                                    description: Namespace selector
                                    type: object
                                  podSelector:
                                    additionalProperties:
                                      type: string
                                    description: Pod selector
                                    type: object
                                type: object
                              type: array
                          type: object
                        type: array
                      enabled:
                        default: false
                        description: Enable network policies
                        type: boolean
                      ingress:
                        description: Ingress rules
                        items:
                          description: NetworkPolicyRule defines a network policy
                            rule
                          properties:
                            from:
                              description: Allowed sources/destinations
                              items:
                                description: NetworkPolicyPeer defines a network policy
                                  peer
                                properties:
                                  namespaceSelector:
                                    additionalProperties:
                                      type: string
                                    description: Namespace selector
                                    type: object
                                  podSelector:
                                    additionalProperties:
                                      type: string
                                    description: Pod selector
                                    type: object
                                type: object
                              type: array
                            ports:
                              description: Allowed ports
                              items:
                                description: NetworkPolicyPort defines a network policy
                                  port
                                properties:
                                  port:
                                    anyOf:
                                    - type: integer
                                    - type: string
                                    description: Port number or name
                                    x-kubernetes-int-or-string: true
                                  protocol:
                                    default: TCP
                                    description: Protocol
                                    enum:
                                    - TCP
                                    - UDP
                                    - SCTP
                                    type: string
                                type: object
                              type: array
                            to:
                              description: Allowed destinations/sources
                              items:
                                description: NetworkPolicyPeer defines a network policy
                                  peer
                                properties:
                                  namespaceSelector:
                                    additionalProperties:
                                      type: string
                                    description: Namespace selector
                                    type: object
                                  podSelector:
                                    additionalProperties:
                                      type: string
                                    description: Pod selector
                                    type: object
                                type: object
                              type: array
                          type: object
                        type: array
                    type: object
                  rbac:
                    description: RBAC configuration
                    properties:
                      clusterRoles:
                        description: Additional cluster roles
                        items:
                          type: string
                        type: array
                      enabled:
                        default: false
                        description: Enable RBAC
                        type: boolean
                      roles:
                        description: Additional roles
                        items:
                          type: string
                        type: array
                      serviceAccount:
                        description: Service account for roost operations
                        type: string
                    type: object
                  resourceQuota:
                    description: Resource quotas
                    properties:
                      enabled:
                        default: false
                        description: Enable resource quotas
                        type: boolean
                      hard:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          x-kubernetes-int-or-string: true
                        description: Hard resource limits
                        type: object
                      scopes:
                        description: Scopes for resource quota
                        items:
                          type: string
                        type: array
                    type: object
                  tenantId:
                    description: Tenant identifier
                    type: string
                type: object
            required:
            - chart
            type: object
          status:
            description: ManagedRoostStatus defines the observed state of ManagedRoost
            properties:
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              health:
                description: Overall health status
                enum:
                - healthy
                - unhealthy
                - degraded
                - unknown
                type: string
              healthChecks:
                description: Health check results
                items:
                  description: HealthCheckStatus defines the status of a health check
                  properties:
                    failureCount:
                      description: Failure count
                      format: int32
                      type: integer
                    lastCheck:
                      description: Last check time
                      format: date-time
                      type: string
                    message:
                      description: Error message
                      type: string
                    name:
                      description: Health check name
                      type: string
                    status:
                      description: Health check status
                      enum:
                      - healthy
                      - unhealthy
                      - unknown
                      type: string
                  required:
                  - name
                  type: object
                type: array
              helmRelease:
                description: Helm release information
                properties:
                  description:
                    description: Release description
                    type: string
                  lastDeployed:
                    description: Last deployed time
                    format: date-time
                    type: string
                  name:
                    description: Release name
                    type: string
                  notes:
                    description: Release notes
                    type: string
                  revision:
                    description: Release revision
                    format: int32
                    type: integer
                  status:
                    description: Release status
                    type: string
                type: object
              lastReconcileTime:
                description: Last reconcile time
                format: date-time
                type: string
              lastUpdateTime:
                description: Last update timestamp
                format: date-time
                type: string
              observability:
                description: Observability information
                properties:
                  logging:
                    description: Logging status
                    properties:
                      level:
                        description: Current log level
                        type: string
                      outputs:
                        description: Output statuses
                        items:
                          description: LogOutputStatus defines log output status
                          properties:
                            error:
                              description: Error message
                              type: string
                            status:
                              description: Output status
                              type: string
                            type:
                              description: Output type
                              type: string
                          required:
                          - type
                          type: object
                        type: array
                      structured:
                        description: Structured logging enabled
                        type: boolean
                    type: object
                  metrics:
                    description: Metrics collection status
                    properties:
                      enabled:
                        description: Metrics enabled
                        type: boolean
                      errors:
                        description: Collection errors
                        items:
                          type: string
                        type: array
                      lastCollection:
                        description: Last collection time
                        format: date-time
                        type: string
                    type: object
                  tracing:
                    description: Tracing status
                    properties:
                      activeSpans:
                        description: Active spans count
                        format: int32
                        type: integer
                      enabled:
                        description: Tracing enabled
                        type: boolean
                      endpointStatus:
                        description: Endpoint status
                        type: string
                    type: object
                type: object
              observedGeneration:
                description: Generation observed by the controller
                format: int64
                type: integer
              phase:
                description: Phase represents the current phase of the ManagedRoost
                type: string
              teardown:
                description: Teardown status
                properties:
                  completionTime:
                    description: Completion time
                    format: date-time
                    type: string
                  progress:
                    description: Progress percentage
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  triggerReason:
                    description: Trigger reason
                    type: string
                  triggerTime:
                    description: Trigger time
                    format: date-time
                    type: string
                  triggered:
                    description: Teardown triggered
                    type: boolean
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
